# SemOpenAlex - Создание датасета из OpenAlex S3

Этот проект позволяет создать связный и полноформатный датасет из OpenAlex S3 в объёме ~5–15 ГБ, соблюдая ограничения по ресурсам, и подготовить данные для записи в три модели хранения: PostgreSQL, Neo4j и ClickHouse.

## Описание

SemOpenAlex - это инструмент для создания подмножества данных из полного датасета OpenAlex. Проект позволяет:

1. Загрузить ограниченное количество файлов из OpenAlex S3
2. Обработать публикации (works) с фильтрацией по году и типу
3. Извлечь связанные сущности (авторы, организации, концепции, источники, издатели)
4. Создать CSV-файлы, готовые для импорта в различные базы данных
5. Проверить объём и связность полученного датасета

## Требования

- Python 3.7+
- Необходимые библиотеки: pandas, tqdm, requests

```bash
pip install pandas tqdm requests
```

## Структура проекта

```
SemOpenAlex/
├── main.py                # Основной скрипт для запуска всего процесса
├── download_data.py       # Скрипт для загрузки данных из OpenAlex S3
├── process_works.py       # Скрипт для обработки публикаций
├── process_entities.py    # Скрипт для обработки связанных сущностей
├── check_dataset.py       # Скрипт для проверки объёма и связности данных
├── data/                  # Директория для загруженных данных
│   ├── works/             # Публикации
│   │   ├── updated_date_2025-05-15.jsonl.gz
│   │   ├── updated_date_2025-05-16.jsonl.gz
│   │   └── ...
│   ├── authors/           # Авторы
│   │   ├── part_000.jsonl.gz
│   │   └── ...
│   ├── concepts/          # Концепции
│   ├── institutions/      # Организации
│   ├── venues/            # Источники
│   └── publishers/        # Издатели
└── output/                # Директория для выходных CSV-файлов
```

## Использование

### Запуск полного процесса

```bash
python main.py
```

По умолчанию скрипт запускается в интерактивном режиме, запрашивая подтверждение перед каждым шагом.

### Режимы работы

- **Интерактивный режим** (по умолчанию): запрашивает подтверждение перед каждым шагом
- **Неинтерактивный режим**: выполняет все шаги автоматически без запросов

### Параметры командной строки

- `--non-interactive`: Запустить в неинтерактивном режиме (без запросов подтверждения)
- `--skip-download`: Пропустить загрузку данных
- `--skip-works`: Пропустить обработку публикаций
- `--skip-entities`: Пропустить обработку связанных сущностей
- `--skip-check`: Пропустить проверку датасета
- `--max-works`: Максимальное количество публикаций для обработки (по умолчанию 100000)

### Примеры запуска

```bash
# Запуск в интерактивном режиме (по умолчанию)
python main.py

# Запуск в неинтерактивном режиме
python main.py --non-interactive

# Запуск с ограничением в 50000 публикаций
python main.py --max-works 50000

# Запуск только проверки датасета
python main.py --skip-download --skip-works --skip-entities

# Запуск только загрузки данных
python main.py --skip-works --skip-entities --skip-check
```

## Интерактивный режим

В интерактивном режиме программа запрашивает подтверждение перед выполнением каждого шага:

1. **Загрузка данных из OpenAlex S3** - загрузка файлов из S3
2. **Обработка публикаций (works)** - фильтрация и обработка публикаций
3. **Обработка связанных сущностей** - обработка авторов, организаций и т.д.
4. **Проверка датасета** - проверка объема и связности данных

Для каждого шага можно выбрать один из вариантов:
- `да` - выполнить шаг
- `нет` - остановить выполнение программы
- `пропустить` - пропустить текущий шаг и перейти к следующему

## Выходные данные

Скрипт создает следующие CSV-файлы в директории `output/`:

### Основные сущности:
- `works.csv`: Публикации
- `authors.csv`: Авторы
- `institutions.csv`: Организации
- `concepts.csv`: Концепции
- `venues.csv`: Источники публикаций
- `publishers.csv`: Издатели

### Связи между сущностями:
- `author_work.csv`: Связи автор-публикация
- `work_concept.csv`: Связи публикация-концепция
- `work_venue.csv`: Связи публикация-источник
- `venue_publisher.csv`: Связи источник-издатель
- `author_institution.csv`: Связи автор-организация
- `work_citation.csv`: Связи цитирования между публикациями
- `concept_ancestor.csv`: Иерархические связи между концепциями

### Метаданные:
- `metadata.json`: Информация о размере датасета, количестве строк и проблемах связности

## Логирование

Процесс выполнения логируется в следующие файлы:
- `semopenalex.log`: Основной лог
- `download.log`: Лог загрузки данных
- `processing.log`: Лог обработки данных
- `check.log`: Лог проверки датасета

## Особенности загрузки данных

- Для публикаций (works) загружаются файлы `part_000.gz` из нескольких папок с разными датами обновления (например, `updated_date=2025-05-15`, `updated_date=2025-05-16` и т.д.)
- Для остальных сущностей (авторы, организации и т.д.) используется фиксированная дата снапшота
- Количество загружаемых дат для works можно изменить через константу `WORKS_DATES_COUNT` в файле `download_data.py`
- Список валидных дат можно изменить через константу `VALID_DATES` в файле `download_data.py`

## Ограничения

- Датасет ограничен первыми N файлами из каждого каталога OpenAlex S3
- Публикации фильтруются по году (>= 2020) и типу (journal-article)
- Максимальное количество публикаций ограничено параметром `--max-works`

## Полезные ссылки

- [OpenAlex S3 Browser](https://openalex.s3.amazonaws.com/browse.html#data/)
- [GitHub репозиторий для генерации SemOpenAlex](https://github.com/metaphacts/semopenalex)
- [Документация OpenAlex snapshot](https://docs.openalex.org/download-all-data/openalex-snapshot) 